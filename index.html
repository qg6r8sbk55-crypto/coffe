<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–û—Ç—á–µ—Ç –ö–æ—Ñ–µ–π–Ω–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #1e1e2f 0%, #2a2a40 100%);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            --text-main: #ffffff;
            --text-muted: #a0a0b5;
            --accent: #d4a373;
            --accent-hover: #faedcd;
            --danger: #e63946;
            --success: #2a9d8f;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
            padding: 20px 16px 100px;
            overflow-x: hidden;
        }

        /* Glassmorphism Classes */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--glass-shadow);
            padding: 20px;
            margin-bottom: 24px;
            animation: fadeIn 0.4s ease;
        }

        /* Profile Header */
        .profile-card {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
        }

        .avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), #b5835a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(212, 163, 115, 0.4);
            color: white;
        }

        .profile-info h2 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .profile-info p {
            color: var(--text-muted);
            font-size: 13px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 6px;
            margin-bottom: 24px;
            position: relative;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .tab.active {
            color: var(--bg-gradient);
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(212, 163, 115, 0.3);
            font-weight: 600;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: slideIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Category Title */
        .category-title {
            font-size: 18px;
            font-weight: 600;
            margin: 24px 0 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-title i {
            font-style: normal;
        }

        /* Counter Item */
        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s, background 0.2s;
        }

        .item:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.07);
        }

        .item-name {
            font-size: 15px;
            font-weight: 500;
        }

        .counter-group {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 4px;
        }

        .btn-counter {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: var(--accent);
            font-size: 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .btn-counter:active {
            background: rgba(212, 163, 115, 0.2);
        }

        .counter-value {
            width: 44px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-main);
            background: transparent;
            border: none;
            outline: none;
        }

        .counter-value::-webkit-inner-spin-button,
        .counter-value::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Finance Inputs */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .amount-input,
        .text-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 16px;
            color: white;
            font-size: 20px;
            font-family: 'Outfit', sans-serif;
            font-weight: 500;
            transition: border-color 0.3s, box-shadow 0.3s;
            outline: none;
        }

        .amount-input:focus,
        .text-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(212, 163, 115, 0.2);
        }

        .text-input {
            font-size: 15px;
            min-height: 100px;
            resize: vertical;
        }

        /* Total Preview */
        .total-preview {
            background: linear-gradient(135deg, rgba(42, 157, 143, 0.1), rgba(42, 157, 143, 0.05));
            border: 1px solid rgba(42, 157, 143, 0.3);
            border-radius: 16px;
            padding: 16px;
            margin-top: 24px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: var(--success);
            display: none;
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>

<body>

    <!-- Header -->
    <div class="profile-card glass-panel">
        <div class="avatar" id="avatar">–ë</div>
        <div class="profile-info">
            <h2 id="username">–ë–∞—Ä–∏—Å—Ç–∞</h2>
            <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–º–µ–Ω—ã</p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab(event, 'drinks')">‚òïÔ∏è –ù–∞–ø–∏—Ç–∫–∏</div>
        <div class="tab" onclick="switchTab(event, 'food')">ü•ê –ï–¥–∞</div>
        <div class="tab" onclick="switchTab(event, 'finance')">üí∞ –ö–∞—Å—Å–∞</div>
        <div class="tab" onclick="switchTab(event, 'inventory')">üì¶ –°–∫–ª–∞–¥</div>
    </div>

    <!-- Drinks Tab -->
    <div id="drinks" class="tab-content active glass-panel">
        <div class="category-title"><i>‚òïÔ∏è</i> –ü—Ä–æ–¥–∞–∂–∏ –Ω–∞–ø–∏—Ç–∫–æ–≤</div>
        <div id="drinks-container"></div>
    </div>

    <!-- Food Tab -->
    <div id="food" class="tab-content glass-panel">
        <div class="category-title"><i>ü•ê</i> –ü—Ä–æ–¥–∞–∂–∏ –µ–¥—ã</div>
        <div id="food-container"></div>
    </div>

    <!-- Finance Tab -->
    <div id="finance" class="tab-content glass-panel">
        <div class="category-title"><i>üí∞</i> –§–∏–Ω–∞–Ω—Å—ã –∑–∞ —Å–º–µ–Ω—É</div>

        <div class="input-group">
            <label>–ù–∞–ª–∏—á–Ω—ã–µ –≤ –∫–∞—Å—Å–µ</label>
            <input type="number" id="cash" class="amount-input check-val" placeholder="0" min="0" inputmode="numeric"
                oninput="checkValidation()">
        </div>

        <div class="input-group">
            <label>–ë–µ–∑–Ω–∞–ª / –¢–µ—Ä–º–∏–Ω–∞–ª</label>
            <input type="number" id="card" class="amount-input check-val" placeholder="0" min="0" inputmode="numeric"
                oninput="checkValidation()">
        </div>

        <div class="input-group">
            <label>–†–∞—Å—Ö–æ–¥—ã –∏–∑ –∫–∞—Å—Å—ã (—Å–ø–∏—Å–∞–Ω–∏—è)</label>
            <input type="number" id="expenses" class="amount-input" placeholder="0" min="0" inputmode="numeric">
        </div>

        <div class="input-group" style="margin-top: 32px;">
            <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
            <textarea id="comment" class="text-input"
                placeholder="–û–ø–∏—à–∏—Ç–µ, –µ—Å–ª–∏ –±—ã–ª–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã..."></textarea>
        </div>

        <div id="totalPreview" class="total-preview">
            –ò—Ç–æ–≥–æ: 0 —Ä—É–±. | –ü–æ–∑–∏—Ü–∏–π: 0
        </div>
    </div>

    <!-- Inventory Tab -->
    <div id="inventory" class="tab-content glass-panel">
        <div class="category-title"><i>üì¶</i> –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤</div>
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 20px; line-height: 1.5;">–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –∏—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ (–∑–∞–∫—É–ø–∫–µ), —á—Ç–æ–±—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ.</p>
        <div id="inventory-container"></div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram API
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            const user = tg.initDataUnsafe.user;
            document.getElementById('username').innerText = user.first_name || '–ë–∞—Ä–∏—Å—Ç–∞';
            document.getElementById('avatar').innerText = (user.first_name || '–ë').charAt(0).toUpperCase();
        } else {
            document.getElementById('username').innerText = '–ì–æ—Å—Ç—å';
            document.getElementById('avatar').innerText = '–ì';
        }

        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª–µ–π
        const drinksData = [
            { id: 'espresso', name: '–≠—Å–ø—Ä–µ—Å—Å–æ' },
            { id: 'americano', name: '–ê–º–µ—Ä–∏–∫–∞–Ω–æ' },
            { id: 'cappuccino', name: '–ö–∞–ø—É—á–∏–Ω–æ' },
            { id: 'latte', name: '–õ–∞—Ç—Ç–µ' },
            { id: 'flatwhite', name: '–§–ª—ç—Ç –£–∞–π—Ç' },
            { id: 'raf', name: '–†–∞—Ñ' },
            { id: 'tea', name: '–ß–∞–π' },
            { id: 'other_drinks', name: '–î—Ä—É–≥–∏–µ –Ω–∞–ø–∏—Ç–∫–∏' }
        ];

        const foodData = [
            { id: 'pastry', name: '–í—ã–ø–µ—á–∫–∞' },
            { id: 'dessert', name: '–î–µ—Å–µ—Ä—Ç—ã' },
            { id: 'sandwiches', name: '–°—ç–Ω–¥–≤–∏—á–∏' }
        ];

        const inventoryData = [
            { id: 'inv_beans', name: '–ó–µ—Ä–Ω–æ (–≥—Ä.)', step: 1000 },
            { id: 'inv_milk', name: '–ú–æ–ª–æ–∫–æ (–º–ª.)', step: 1000 },
            { id: 'inv_alt_milk', name: '–ê–ª—å—Ç. –º–æ–ª–æ–∫–æ (–º–ª.)', step: 1000 },
            { id: 'inv_syrup', name: '–°–∏—Ä–æ–ø—ã (–º–ª.)', step: 1000 },
            { id: 'inv_cups_s', name: '–°—Ç–∞–∫–∞–Ω—ã –ú–∞–ª. (—à—Ç)', step: 50 },
            { id: 'inv_cups_l', name: '–°—Ç–∞–∫–∞–Ω—ã –ë–æ–ª. (—à—Ç)', step: 50 },
            { id: 'inv_lids', name: '–ö—Ä—ã—à–∫–∏ (—à—Ç)', step: 100 }
        ];

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∞ HTML-–±–ª–æ–∫–∞
        function createCounter(item, isInventory = false) {
            const step = item.step || 1;
            const targetClass = isInventory ? 'inv-val' : 'check-val';
            return `
            <div class="item">
                <div class="item-name">${item.name}</div>
                <div class="counter-group">
                    <button class="btn-counter" onclick="window.changeValue('${item.id}', -${step})">‚àí</button>
                    <input type="number" id="${item.id}" class="counter-value ${targetClass}" value="0" min="0" inputmode="numeric" oninput="window.checkValidation()">
                    <button class="btn-counter" onclick="window.changeValue('${item.id}', ${step})">+</button>
                </div>
            </div>`;
        }

        // –†–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –î–û–ú
        document.getElementById('drinks-container').innerHTML = drinksData.map(i => createCounter(i, false)).join('');
        document.getElementById('food-container').innerHTML = foodData.map(i => createCounter(i, false)).join('');
        document.getElementById('inventory-container').innerHTML = inventoryData.map(i => createCounter(i, true)).join('');

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
        window.switchTab = function (event, tabId) {
            if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();

            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');

            if (event) {
                event.currentTarget.classList.add('active');
            } else {
                // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π (–ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –±–æ—Ç–∞), –∏—â–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ—ë —Å—Ç–∏–ª–∏
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    const text = tab.innerText.toLowerCase();
                    if ((tabId === 'inventory' && text.includes('—Å–∫–ª–∞–¥')) ||
                        (tabId === 'finance' && text.includes('–∫–∞—Å—Å–∞')) ||
                        (tabId === 'food' && text.includes('–µ–¥–∞')) ||
                        (tabId === 'drinks' && text.includes('–Ω–∞–ø–∏—Ç–∫–∏'))) {
                        tab.classList.add('active');
                    }
                });
            }

            window.checkValidation();
        };

        // –ß—Ç–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        const urlParams = new URLSearchParams(window.location.search);
        const startTab = urlParams.get('tab');
        if (startTab === 'inventory') {
            window.switchTab(null, 'inventory');
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π +/-
        window.changeValue = function (id, delta) {
            const input = document.getElementById(id);
            let val = parseInt(input.value) || 0;
            val += delta;
            if (val < 0) val = 0;
            input.value = val;

            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            window.checkValidation();
        };

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
        window.checkValidation = function () {
            const isInventory = document.getElementById('inventory').classList.contains('active');

            if (isInventory) {
                // –õ–æ–≥–∏–∫–∞ –¥–ª—è —Å–∫–ª–∞–¥–∞
                document.getElementById('totalPreview').style.display = 'none';
                let totalInv = 0;
                document.querySelectorAll('.inv-val').forEach(inp => totalInv += (parseInt(inp.value) || 0));

                if (totalInv > 0) {
                    tg.MainButton.text = "–û–¢–ü–†–ê–í–ò–¢–¨ –ü–†–ò–•–û–î –¢–û–í–ê–†–ê";
                    tg.MainButton.color = "#2a9d8f";
                    tg.MainButton.textColor = "#ffffff";
                    tg.MainButton.show();
                } else {
                    tg.MainButton.hide();
                }
            } else {
                // –õ–æ–≥–∏–∫–∞ –¥–ª—è –æ—Ç—á–µ—Ç–∞ —Å–º–µ–Ω—ã
                let totalItems = 0;
                document.querySelectorAll('.check-val').forEach(inp => totalItems += (parseInt(inp.value) || 0));

                const cash = parseInt(document.getElementById('cash').value) || 0;
                const card = parseInt(document.getElementById('card').value) || 0;
                const totalFin = cash + card;

                const preview = document.getElementById('totalPreview');
                if (totalItems > 0 || totalFin > 0) {
                    preview.style.display = 'block';
                    preview.innerText = `–ò—Ç–æ–≥–æ: ${totalFin} —Ä—É–±. | –ü–æ–∑–∏—Ü–∏–π: ${totalItems}`;
                    tg.MainButton.text = "–û–¢–ü–†–ê–í–ò–¢–¨ –û–¢–ß–ï–¢";
                    tg.MainButton.color = "#d4a373";
                    tg.MainButton.textColor = "#1e1e2f";
                    tg.MainButton.show();
                } else {
                    preview.style.display = 'none';
                    tg.MainButton.hide();
                }
            }
        };

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        window.submitData = function () {
            const isInventory = document.getElementById('inventory').classList.contains('active');
            let data = {};

            if (isInventory) {
                data = { type: 'inventory_arrival', items: {} };
                inventoryData.forEach(i => {
                    data.items[i.id] = parseInt(document.getElementById(i.id).value) || 0;
                });
            } else {
                data = {
                    type: 'shift_report',
                    items: {},
                    finances: {
                        cash: parseInt(document.getElementById('cash').value) || 0,
                        card: parseInt(document.getElementById('card').value) || 0,
                        expenses: parseInt(document.getElementById('expenses').value) || 0
                    },
                    comment: document.getElementById('comment').value || "–ù–µ—Ç"
                };
                drinksData.forEach(d => { data.items[d.id] = parseInt(document.getElementById(d.id).value) || 0; });
                foodData.forEach(f => { data.items[f.id] = parseInt(document.getElementById(f.id).value) || 0; });
            }

            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            tg.MainButton.showProgress();

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            setTimeout(() => {
                tg.sendData(JSON.stringify(data));
            }, 50);
        };

        tg.MainButton.onClick(window.submitData);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–æ–π –∫–Ω–æ–ø–∫–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
        tg.MainButton.hide();

    </script>
</body>

</html>